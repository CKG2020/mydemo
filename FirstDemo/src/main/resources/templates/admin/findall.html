<!DOCTYPE html>
<html xmlns:background-color="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <title>admin</title>
    <link rel="stylesheet" type="text/css" href="http://unpkg.com/view-design/dist/styles/iview.css">
    <script type="text/javascript" src="http://vuejs.org/js/vue.min.js"></script>
    <script type="text/javascript" src="http://unpkg.com/view-design/dist/iview.min.js"></script>
</head>
<body onload="allcount();findall()" style="background-color: #f0f0f0">
<script src="//unpkg.com/vue/dist/vue.js"></script>
<script src="//unpkg.com/iview/dist/iview.min.js"></script>
<script src="http://code.jquery.com/jquery-latest.js"></script>
<div style="margin-top: 45px;margin-left: 25px;">
    <h1>欢迎您！管理员</h1>
</div>
<div id="app-2" style="float: left;margin-top: 62px;height: 500px;" >
    <row>
        <i-col span="8">
            <i-menu :theme="theme2" open-names="['1','2']">
                <submenu name="1">
                    <template slot="title">
                        用户管理
                        <icon type="ios-paper" />
                    </template>
                    <menu-item name="1-1">新增用户</menu-item>
                    <menu-item name="1-2">用户查询</menu-item>
                    <menu-item name="1-3">删除用户</menu-item>
                </submenu>
                <submenu name="2">
                    <template slot="title">
                        统计分析
                        <icon type="ios-people" />
                    </template>
                    <menu-item name="2-1">答题情况</menu-item>
                    <menu-item name="2-2">综合分析</menu-item>
                </submenu>
                <submenu name="3">
                    <template slot="title">
                        聊天室监控
                        <icon type="ios-stats" />
                    </template>
                </submenu>
            </i-menu>
        </i-col>
    </row>
    <br>
    <p style="margin-left: 50px">   Change theme</p>
    <radio-group v-model="theme2" style="margin-left: 40px">
        <radio label="light"></radio>
        <radio label="dark"></radio>
    </radio-group>
</div>

<div id="app">
    <i-input  v-model="Sno" placeholder="按学号查询" style="width: 160px;margin-left: 25px" clearable></i-input>
    <i-button shape="circle" icon="ios-search" @click="searchbySno" ></i-button>
    <i-input  v-model="Sname" placeholder="按姓名查询" style="width: 160px;margin-left: 30px" clearable></i-input>
    <i-button shape="circle" icon="ios-search" @click="searchbyName"></i-button>
    <i-input  v-model="Sclass" placeholder="按班级查询" style="width: 160px;margin-left: 30px" clearable></i-input>
    <i-button shape="circle" icon="ios-search" @click="searchbyClass"></i-button>
    <i-input  v-model="Collage" placeholder="按学院查询" style="width: 160px;margin-left: 30px" clearable></i-input>
    <i-button shape="circle" icon="ios-search" @click="searchbyCollage"></i-button>
    <i-input  v-model="Sage" placeholder="按年龄查询" style="width: 160px;margin-left: 30px" clearable></i-input>
    <i-button shape="circle" icon="ios-search" @click="searchbySage"></i-button>

    <div style="margin: 30px 0">
        <i-table stripe :columns="columns1" :data="data1" ></i-table>
    </div>
    <div style="margin-left: 50px">
        <page :total="dataCount" :page-size="pageSize" :current.sync="pageNum"
              @on-change="changepage" show-total></page>
    </div>


</div>

<script>
    var cols = [
        {
            title: 'Sno',
            key: 'sno'
        },
        {
            title: "Sname",
            key: "sname"
        },
        {
            title: "Sage",
            key: "sage"
        },
        {
            title: "Scall",
            key: "scall"
        },
        {
            title: 'Collage',
            key: 'collage'
        },
        {
            title: "Major",
            key: "major"
        },
        {
            title: "Scalss",
            key: "sclass"
        },
        {
            title: "friends",
            key: 'friends'
        }
    ];
    function allcount() {
        $.ajax({
            url:'/admin/findallcount',
            type:'get',
            success(res){
                setMeau();
                setPage(res);
            }
        })
    }
    function findall() {
        $.ajax({
            url:'/admin/findall',
            type:'get'
        })
    }
    function countSage() {
        $.ajax({
            url:'/admin/findAgeCount',
            type:'get',
            data:{
                "age":Page.Sage
            },
            success(res){
                Page.dataCount=res;
            }
        })
    }
    function countName() {
        $.ajax({
            url:'/admin/findNameCount',
            type:'get',
            data:{
                "Sname":Page.Sname
            },
            success(res){
                Page.dataCount=res;
            }
        })
    }
    function countClass() {
        $.ajax({
            url:'/admin/findClassCount',
            type:'get',
            data:{
                "Sclass":Page.Sclass
            },
            success(res){
                Page.dataCount=res;
            }
        })
    }
    function countCollage() {
        $.ajax({
            url:'/admin/findCollageCount',
            type:'get',
            data:{
                "Collage":Page.Collage
            },
            success(res){
                Page.dataCount=res;
            }
        })
    }
    function countSno() {
        $.ajax({
            url:'/admin/findSnoCount',
            type:'get',
            data:{
                "Sno":Page.Sno,
            },
            success(res) {
                Page.dataCount=res;
            }
        })
    }

    var Page = new Vue({
       el:'#app',
       data() {
           return{
               columns1:[],
               data1:[],
               dataCount:0,
               pageSize:8,
               pageNum:1,
               Sno:'',
               Sname:'',
               Sclass:'',
               Collage:'',
               Sage:''
           }
       },
        methods:{
            changepage(){
                let curr = this.pageNum;
                $.ajax({
                    url: '/admin/findpage',
                    type: 'get',
                    data: {
                        "curr": curr,
                        "pageSize": this.pageSize
                    },
                    success(res) {
                        let msg = JSON.stringify(res);
                        msg = $.parseJSON(msg);
                        setTable(cols, msg);
                    }
                })
            },
            searchbySno(){
                countSno();
                sno=this.Sno;
                $.ajax({
                    type:'get',
                    url:'/admin/findbySno',
                    data:{
                        "Sno":sno,
                    }
                });
                this.changepage();
            },
            searchbySage(){
                countSage();
                sage=this.Sage;
                $.ajax({
                    type:'get',
                    url:'/admin/findbyAge',
                    data:{
                        "Sage":sage
                    }
                });
                this.changepage()
            },
            searchbyCollage(){
                countCollage();
                collage=this.Collage;
                $.ajax({
                    type:'get',
                    url:'/admin/findbyCollage',
                    data:{
                        "Collage":collage
                    }
                });
                this.changepage()
            },
            searchbyName(){
                countName();
                sname=this.Sname;
                $.ajax({
                    type:'get',
                    url:'/admin/findbyName',
                    data:{
                        "Sname":sname
                    }
                });
                this.changepage()
            },
            searchbyClass(){
                countClass();
                sclass=this.Sclass;
                $.ajax({
                    type:'get',
                    url:'/admin/findbyClass',
                    data:{
                        "Sclass":sclass
                    }
                });
                this.changepage()
            }
        }
    });

    //初始化
    function setPage(all) {
        Page.dataCount=all;
        Page.changepage();
    }

    function setTable(columns,dat) {
        Page.columns1=columns;
        Page.data1=dat;
    }

    function setMeau() {
        var Main = {
            data () {
                return {
                    theme2: 'light'
                }
            }
        };
        var Component = Vue.extend(Main);
        new Component().$mount('#app-2');
    }



</script>
</body>
</html>
